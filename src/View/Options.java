/*
 * To change this license header, choose License Headers in Project Properties.
 * To change this template file, choose Tools | Templates
 * and open the template in the editor.
 */
package View;

import Helper.GitWrapper;
import Helper.SavedVariables;
import Helper.Utils;
import TextEditor.Tex.LatexTextEditor;
import java.awt.Color;
import javax.swing.JPanel;
import javax.swing.SwingUtilities;
import javax.swing.event.ChangeEvent;

/**
 *
 * @author mbrebion
 */
public class Options extends JPanel {

    /**
     * Creates new form Options
     */
    protected MainWindow mw;

    public Options() {
        initComponents();

        if (System.getProperty("os.name").startsWith("Mac OS X")) {
            this.openEditorLabel.setText("open");
        } else {
            this.openEditorLabel.setText("xdg-open");
        }

        // better dealing with jTextField : input is saved whenever the text changes ( we do not wait for return key anymore
        Utils.addChangeListener(pdflatexInput, (ChangeEvent e) -> {
            SavedVariables.setPdflatexCmd(pdflatexInput.getText());
        });

        Utils.addChangeListener(openInput, (ChangeEvent e) -> {
            SavedVariables.setOpenCmd(openInput.getText());
        });

        Utils.addChangeListener(gitFolderInput, (ChangeEvent e) -> {
            SavedVariables.setMainGitDir(gitFolderInput.getText());
        });

        Utils.addChangeListener(templatesFolderInput, (ChangeEvent e) -> {
            SavedVariables.setTexModelsPaths(templatesFolderInput.getText());
        });

        Utils.addChangeListener(outputDirInput, (ChangeEvent e) -> {
            SavedVariables.setOutputDir(outputDirInput.getText());
        });

        Utils.addChangeListener(globalDictTextField, (ChangeEvent e) -> {
            SavedVariables.setGlobalDict(globalDictTextField.getText());
        });

        Utils.addChangeListener(customDictTextField, (ChangeEvent e) -> {
            SavedVariables.setCustomDict(customDictTextField.getText());
        });

        Utils.addChangeListener(colorSetTextField, (ChangeEvent e) -> {
            String color = colorSetTextField.getText();
            int token = LatexTextEditor.getToken((String) tokenComboBox.getSelectedItem());
            try {
                colorSetTextField.setForeground(Utils.getColorFromString(color));
                SavedVariables.setColor(token, color);
            } catch (Exception ex) {
                color = Utils.getStringFromColor(SavedVariables.getColor(token));
                colorSetTextField.setText(color);
                colorSetTextField.setForeground(Utils.getColorFromString(color));
            }
        });

    }

    public boolean isCompletionRequired() {
        return "".equals(this.gitFolderInput.getText());
    }

    public void setMw(MainWindow mw) {
        this.mw = mw;
    }

    public void setGitOutputText(String txt) {
        this.gitOutputText.setText(txt);
        this.gitOutputText.setRows(this.gitOutputText.getLineCount());
        this.revalidate();
        this.repaint();
    }

    public void appendGitOutputText(String txt) {
        this.gitOutputText.append(txt);
        this.gitOutputText.setRows(this.gitOutputText.getLineCount());
        this.revalidate();
        this.repaint();
    }

    /**
     * This method is called from within the constructor to initialize the form.
     * WARNING: Do NOT modify this code. The content of this method is always
     * regenerated by the Form Editor.
     */
    @SuppressWarnings("unchecked")
    // <editor-fold defaultstate="collapsed" desc="Generated Code">//GEN-BEGIN:initComponents
    private void initComponents() {

        jSeparator2 = new javax.swing.JSeparator();
        jPanel2 = new javax.swing.JPanel();
        jLabel9 = new javax.swing.JLabel();
        jCheckBox1 = new javax.swing.JCheckBox();
        jCheckBox2 = new javax.swing.JCheckBox();
        jPanel3 = new javax.swing.JPanel();
        jLabel7 = new javax.swing.JLabel();
        jPanel5 = new javax.swing.JPanel();
        statusButton = new javax.swing.JButton();
        pushButton = new javax.swing.JButton();
        pullButton = new javax.swing.JButton();
        commitButton = new javax.swing.JButton();
        gitOutputText = new javax.swing.JTextArea();
        jSeparator3 = new javax.swing.JSeparator();
        jPanel4 = new javax.swing.JPanel();
        jLabel10 = new javax.swing.JLabel();
        spellCheckBox = new javax.swing.JCheckBox();
        spellPanel = new javax.swing.JPanel();
        jLabel2 = new javax.swing.JLabel();
        jLabel11 = new javax.swing.JLabel();
        globalDictTextField = new javax.swing.JTextField();
        customDictTextField = new javax.swing.JTextField();
        autoCompletionCheckBox = new javax.swing.JCheckBox();
        coloringCheckBox = new javax.swing.JCheckBox();
        coloringPanel = new javax.swing.JPanel();
        tokenComboBox = new javax.swing.JComboBox<>();
        colorSetTextField = new javax.swing.JTextField();
        titlesCheckBox = new javax.swing.JCheckBox();
        jPanel6 = new javax.swing.JPanel();
        jLabel8 = new javax.swing.JLabel();
        pdflatexInput = new javax.swing.JTextField();
        templatesFolderInput = new javax.swing.JTextField();
        jLabel6 = new javax.swing.JLabel();
        openEditorLabel = new javax.swing.JLabel();
        outputDirInput = new javax.swing.JTextField();
        jLabel1 = new javax.swing.JLabel();
        openInput = new javax.swing.JTextField();
        gitFolderInput = new javax.swing.JTextField();
        jLabel4 = new javax.swing.JLabel();
        jLabel5 = new javax.swing.JLabel();
        jSeparator4 = new javax.swing.JSeparator();

        setMaximumSize(new java.awt.Dimension(430, 32767));

        jLabel9.setFont(new java.awt.Font("Lucida Grande", 3, 13)); // NOI18N
        jLabel9.setText("Actions :");

        jCheckBox1.setSelected(SavedVariables.getAutoSave());
        jCheckBox1.setText("Sauvegarde auto");
        jCheckBox1.setToolTipText("<html>\nLes fichiers sont <em>automatiquement</em> sauvegardés quand les onglets sont cachés.\n<br>\nCela peut être utile lorsque vous selectionnez un nouvel exercice (l'ancien disparait).\n</html>");
        jCheckBox1.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                jCheckBox1ActionPerformed(evt);
            }
        });

        jCheckBox2.setSelected(SavedVariables.getMultiEdit());
        jCheckBox2.setText("Mode avancé");
        jCheckBox2.setToolTipText("<html> Permet d'activer le mode <em>avancé</em> <br> \nqui permet de modifier simultanément plusieurs exercices <br>\n(find and replace) sur les mots clefs ou bien des expressions présentes <br>\ndans les fichiers sujet.tex et aussi de verifier si l'ensemble des exercices compile sans erreur.\n</html>");
        jCheckBox2.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                jCheckBox2ActionPerformed(evt);
            }
        });

        javax.swing.GroupLayout jPanel2Layout = new javax.swing.GroupLayout(jPanel2);
        jPanel2.setLayout(jPanel2Layout);
        jPanel2Layout.setHorizontalGroup(
            jPanel2Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
            .addGroup(jPanel2Layout.createSequentialGroup()
                .addContainerGap()
                .addComponent(jLabel9)
                .addContainerGap(javax.swing.GroupLayout.DEFAULT_SIZE, Short.MAX_VALUE))
            .addGroup(jPanel2Layout.createSequentialGroup()
                .addComponent(jCheckBox1)
                .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.UNRELATED)
                .addComponent(jCheckBox2)
                .addGap(0, 125, Short.MAX_VALUE))
        );
        jPanel2Layout.setVerticalGroup(
            jPanel2Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
            .addGroup(jPanel2Layout.createSequentialGroup()
                .addComponent(jLabel9)
                .addGap(4, 4, 4)
                .addGroup(jPanel2Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.BASELINE)
                    .addComponent(jCheckBox1)
                    .addComponent(jCheckBox2))
                .addGap(6, 6, 6))
        );

        jLabel7.setFont(new java.awt.Font("Lucida Grande", 3, 13)); // NOI18N
        jLabel7.setText("Git :");

        jPanel5.setLayout(new java.awt.GridLayout(1, 0));

        statusButton.setText("Status");
        statusButton.setToolTipText("<html>\nVérifie les actions GIT à effectuer.\n<br>\nCette commande est équivalente à la saisie sur le terminal de :  \n<ol>\n    <li> git fetch \n    <li> git status\n</ol>\n</html>");
        statusButton.setMaximumSize(new java.awt.Dimension(60, 22));
        statusButton.setMinimumSize(new java.awt.Dimension(60, 22));
        statusButton.setPreferredSize(new java.awt.Dimension(60, 22));
        statusButton.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                statusButtonActionPerformed(evt);
            }
        });
        jPanel5.add(statusButton);

        pushButton.setText("Push");
        pushButton.setToolTipText("<html>\nEnvoie le dernier commit effetué (sauvegarde) sur le serveur. \n<br>\nLes conflits (plusieurs personnes modifiant le même fichier en même temps) n'étant pas gérés à partir de l'interface graphique. Il faudra dans ce cas utiliser un logiciel dédié ou bien le terminal.\n</html>");
        pushButton.setEnabled(false);
        pushButton.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                pushButtonActionPerformed(evt);
            }
        });
        jPanel5.add(pushButton);

        pullButton.setText("Pull");
        pullButton.setToolTipText("Réccupère les nouvelles données (dernier commit) depuis le serveur.");
        pullButton.setEnabled(false);
        pullButton.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                pullButtonActionPerformed(evt);
            }
        });
        jPanel5.add(pullButton);

        commitButton.setText("Commit");
        commitButton.setToolTipText("Réalise une sauvegarde (commit) de la base de donnée. Ce commit pourra ensuite être envoyé sur le serveur (push)");
        commitButton.setEnabled(false);
        commitButton.setMaximumSize(new java.awt.Dimension(70, 29));
        commitButton.setMinimumSize(new java.awt.Dimension(70, 29));
        commitButton.setPreferredSize(new java.awt.Dimension(70, 29));
        commitButton.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                commitButtonActionPerformed(evt);
            }
        });
        jPanel5.add(commitButton);

        gitOutputText.setEditable(false);
        gitOutputText.setBackground(javax.swing.UIManager.getDefaults().getColor("ProgressBar.background"));
        gitOutputText.setColumns(26);
        gitOutputText.setLineWrap(true);
        gitOutputText.setRows(1);
        gitOutputText.setTabSize(4);
        gitOutputText.setText("     click on status to update");
        gitOutputText.setMinimumSize(new java.awt.Dimension(1, 120));

        javax.swing.GroupLayout jPanel3Layout = new javax.swing.GroupLayout(jPanel3);
        jPanel3.setLayout(jPanel3Layout);
        jPanel3Layout.setHorizontalGroup(
            jPanel3Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
            .addGroup(jPanel3Layout.createSequentialGroup()
                .addGroup(jPanel3Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
                    .addComponent(jPanel5, javax.swing.GroupLayout.PREFERRED_SIZE, 339, javax.swing.GroupLayout.PREFERRED_SIZE)
                    .addGroup(jPanel3Layout.createSequentialGroup()
                        .addContainerGap()
                        .addGroup(jPanel3Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
                            .addComponent(jLabel7)
                            .addComponent(gitOutputText, javax.swing.GroupLayout.PREFERRED_SIZE, 327, javax.swing.GroupLayout.PREFERRED_SIZE))))
                .addContainerGap(64, Short.MAX_VALUE))
        );
        jPanel3Layout.setVerticalGroup(
            jPanel3Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
            .addGroup(jPanel3Layout.createSequentialGroup()
                .addGap(0, 0, 0)
                .addComponent(jLabel7)
                .addGap(0, 0, 0)
                .addComponent(jPanel5, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE)
                .addGap(0, 0, Short.MAX_VALUE)
                .addComponent(gitOutputText, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE)
                .addGap(0, 0, 0))
        );

        jLabel10.setFont(new java.awt.Font("Lucida Grande", 3, 13)); // NOI18N
        jLabel10.setText("Editeur :");

        spellCheckBox.setSelected(SavedVariables.getSpellCheck());
        spellCheckBox.setText("Correcteur orthographique");
        spellCheckBox.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                spellCheckBoxActionPerformed(evt);
            }
        });

        spellPanel.setVisible(SavedVariables.getSpellCheck());

        jLabel2.setText("Dictionnaire global");

        jLabel11.setText("Dictionnaire personel");

        globalDictTextField.setText(SavedVariables.getGlobalDict()
        );
        globalDictTextField.setToolTipText("<html>\nChemin d'acces (absolu) vers le dictionnaire principal\n<ul>\n    <li> Fichier à encodage UTF-8  </li>\n    <li> Un seul mot par ligne  </li>\n    <li> Ce fichier ne sera pas modifié par l'application   </li>\n</ul>\nLe dictionnaire sera utilisé pour la verification orthographique (aucune vérification sur la grammaire n'est effectuée !). <br>\nUn exmple de dictionnaire se trouve dans le repertoire \"fichiers_utiles\" de la BPEP.\n</html>");
        globalDictTextField.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                nPerformed(evt);
            }
        });

        customDictTextField.setText(SavedVariables.getCustomDict()
        );
        customDictTextField.setToolTipText("<html>\nChemin d'acces (absolu) vers le dictionnaire personnel\n<ul>\n    <li> Fichier à encodage UTF-8  </li>\n    <li> Un seul mot par ligne  </li>\n    <li> L'application pourra ajouter de nouveaux mots de manière définitive à ce dictionnaire  </li>\n</ul>\nCe dictionnaire pourra acceuillir par exemple des termes scientifiques liés aux exercices et absent du dictionnaire principal.\n</html>");

        javax.swing.GroupLayout spellPanelLayout = new javax.swing.GroupLayout(spellPanel);
        spellPanel.setLayout(spellPanelLayout);
        spellPanelLayout.setHorizontalGroup(
            spellPanelLayout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
            .addGroup(spellPanelLayout.createSequentialGroup()
                .addContainerGap(javax.swing.GroupLayout.DEFAULT_SIZE, Short.MAX_VALUE)
                .addGroup(spellPanelLayout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
                    .addComponent(jLabel2, javax.swing.GroupLayout.Alignment.TRAILING)
                    .addComponent(jLabel11, javax.swing.GroupLayout.Alignment.TRAILING))
                .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.UNRELATED)
                .addGroup(spellPanelLayout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
                    .addComponent(customDictTextField, javax.swing.GroupLayout.PREFERRED_SIZE, 170, javax.swing.GroupLayout.PREFERRED_SIZE)
                    .addComponent(globalDictTextField, javax.swing.GroupLayout.PREFERRED_SIZE, 170, javax.swing.GroupLayout.PREFERRED_SIZE))
                .addGap(142, 142, 142))
        );
        spellPanelLayout.setVerticalGroup(
            spellPanelLayout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
            .addGroup(spellPanelLayout.createSequentialGroup()
                .addContainerGap()
                .addGroup(spellPanelLayout.createParallelGroup(javax.swing.GroupLayout.Alignment.BASELINE)
                    .addComponent(jLabel2)
                    .addComponent(globalDictTextField, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE))
                .addGap(6, 6, 6)
                .addGroup(spellPanelLayout.createParallelGroup(javax.swing.GroupLayout.Alignment.BASELINE)
                    .addComponent(jLabel11)
                    .addComponent(customDictTextField, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE))
                .addGap(4, 4, 4))
        );

        autoCompletionCheckBox.setSelected(SavedVariables.getAutoCompletion());
        autoCompletionCheckBox.setText("auto-completion");
        autoCompletionCheckBox.setToolTipText("Permet d'utiliser l'auto-complétion (déclanchée après la saisie du caractère \"\\\").");
        autoCompletionCheckBox.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                autoCompletionCheckBoxActionPerformed(evt);
            }
        });

        coloringCheckBox.setSelected(SavedVariables.getColoring());
        coloringCheckBox.setText("Coloration syntaxique");
        coloringCheckBox.setToolTipText("<html>\nPermet  d'utiliser la coloration syntaxique.\n<br>\n Bien qu'optimisée, cette option peut rallentir la saisie de texte <br> sur certaines anciennes machines et peut donc être desactivée.\n</html>");
        coloringCheckBox.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                coloringCheckBoxActionPerformed(evt);
            }
        });

        coloringPanel.setVisible(SavedVariables.getColoring());

        tokenComboBox.setToolTipText("Type d'élément");
        for (String s:LatexTextEditor.getTokenNames()){
            tokenComboBox.addItem(s);
        }
        tokenComboBox.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                tokenComboBoxActionPerformed(evt);
            }
        });

        colorSetTextField.setText("jTextField1");
        colorSetTextField.setToolTipText("Couleur au format r,g,b");
        tokenComboBoxAction();
        colorSetTextField.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                colorSetTextFieldActionPerformed(evt);
            }
        });

        titlesCheckBox.setSelected(SavedVariables.getBigTitles());
        titlesCheckBox.setText("Titres et parties en grand");
        titlesCheckBox.setToolTipText("Affiche les titres des parties et sous parties en plus grand");
        titlesCheckBox.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                titlesCheckBoxActionPerformed(evt);
            }
        });

        javax.swing.GroupLayout coloringPanelLayout = new javax.swing.GroupLayout(coloringPanel);
        coloringPanel.setLayout(coloringPanelLayout);
        coloringPanelLayout.setHorizontalGroup(
            coloringPanelLayout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
            .addGroup(coloringPanelLayout.createSequentialGroup()
                .addGroup(coloringPanelLayout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
                    .addGroup(coloringPanelLayout.createSequentialGroup()
                        .addContainerGap()
                        .addComponent(tokenComboBox, javax.swing.GroupLayout.PREFERRED_SIZE, 200, javax.swing.GroupLayout.PREFERRED_SIZE)
                        .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
                        .addComponent(colorSetTextField, javax.swing.GroupLayout.PREFERRED_SIZE, 103, javax.swing.GroupLayout.PREFERRED_SIZE))
                    .addGroup(coloringPanelLayout.createSequentialGroup()
                        .addGap(112, 112, 112)
                        .addComponent(titlesCheckBox)))
                .addContainerGap(125, Short.MAX_VALUE))
        );
        coloringPanelLayout.setVerticalGroup(
            coloringPanelLayout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
            .addGroup(coloringPanelLayout.createSequentialGroup()
                .addGroup(coloringPanelLayout.createParallelGroup(javax.swing.GroupLayout.Alignment.BASELINE)
                    .addComponent(tokenComboBox, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE)
                    .addComponent(colorSetTextField, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE))
                .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED, javax.swing.GroupLayout.DEFAULT_SIZE, Short.MAX_VALUE)
                .addComponent(titlesCheckBox))
        );

        javax.swing.GroupLayout jPanel4Layout = new javax.swing.GroupLayout(jPanel4);
        jPanel4.setLayout(jPanel4Layout);
        jPanel4Layout.setHorizontalGroup(
            jPanel4Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
            .addGroup(jPanel4Layout.createSequentialGroup()
                .addContainerGap()
                .addComponent(jLabel10)
                .addContainerGap(javax.swing.GroupLayout.DEFAULT_SIZE, Short.MAX_VALUE))
            .addGroup(jPanel4Layout.createSequentialGroup()
                .addGroup(jPanel4Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
                    .addComponent(spellCheckBox)
                    .addGroup(jPanel4Layout.createSequentialGroup()
                        .addComponent(autoCompletionCheckBox)
                        .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.UNRELATED)
                        .addComponent(coloringCheckBox))
                    .addComponent(coloringPanel, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE)
                    .addGroup(jPanel4Layout.createSequentialGroup()
                        .addGap(21, 21, 21)
                        .addComponent(spellPanel, javax.swing.GroupLayout.PREFERRED_SIZE, 365, javax.swing.GroupLayout.PREFERRED_SIZE)))
                .addGap(0, 0, Short.MAX_VALUE))
        );
        jPanel4Layout.setVerticalGroup(
            jPanel4Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
            .addGroup(jPanel4Layout.createSequentialGroup()
                .addComponent(jLabel10)
                .addGap(0, 0, 0)
                .addComponent(spellCheckBox)
                .addGap(0, 0, 0)
                .addComponent(spellPanel, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE)
                .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
                .addGroup(jPanel4Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.BASELINE)
                    .addComponent(autoCompletionCheckBox)
                    .addComponent(coloringCheckBox))
                .addGap(4, 4, 4)
                .addComponent(coloringPanel, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE)
                .addGap(4, 4, 4))
        );

        jLabel8.setFont(new java.awt.Font("Lucida Grande", 3, 13)); // NOI18N
        jLabel8.setText("Chemins d'accès :");

        pdflatexInput.setText(SavedVariables.getPdflatexCmd()
        );
        pdflatexInput.setToolTipText("<html>\nChemin d'acces (absolu) vers l'executable pdflatex. <br>\n(Peut être obtenu en tappant \"which pdflatex\" dans un terminal)\n</html>");
        pdflatexInput.setCaretPosition(0);
        pdflatexInput.setMinimumSize(new java.awt.Dimension(6, 6));
        pdflatexInput.setPreferredSize(new java.awt.Dimension(240, 24));

        templatesFolderInput.setText(SavedVariables.getTexModelsPaths());
        templatesFolderInput.setToolTipText("<html>\nChemin d'acces (absolu) vers le dossier contenant les templates latex :\n<ul>\n    <li> DSModel.tex  </li>\n    <li> DMModel.tex  </li>\n    <li> ColleModel.tex  </li>\n    <li> TDModel.tex  </li>\n</ul>\nCes documents servent de template pour l'inclusion des exercices et doivent inclure le fichier fichiers_utiles/raccourcis_communs.sty et contenir une ligne : <br>\n****\n<br> \nqui sera remplacée par l'import des exercices lors de l'édition d'une composition.\n<br>\n<br>\nDes exemples de fichiers fonctionnels se trouvent dans le répertoire path/To/Git/Dir/fichiers_utiles/defaultLatexTemplates\n</html>");
        templatesFolderInput.setPreferredSize(new java.awt.Dimension(240, 24));

        jLabel6.setText("dossier d'export");

        openEditorLabel.setText("open");

        outputDirInput.setText(SavedVariables.getOutputDir());
        outputDirInput.setToolTipText("<html>\nChemin d'acces (absolu) vers le dossier contenant vos DSs/DMs de l'année en cours. <br>\nCe dossier doit contenir un sous dossier nommé DM et un autre nommé DS. <br>\nAinsi, une composition type DS exportée sera placé dans le sous dossier DS de manière incrémentielle (exemple DS5 si un dossier DS4 est déjà présent).\n<br> <br>\nLes composition exportées seront copiées de manière pérènne à cet endroit et ne seront pas affectées par des modifications ultérieurs de la BPEP.\n</html>");
        outputDirInput.setPreferredSize(new java.awt.Dimension(240, 24));

        jLabel1.setText("pdflatex");

        openInput.setText(SavedVariables.getOpenCmd());
        openInput.setToolTipText("Chemin d'acces (absolu) vers la commande open (MacOS) ou xdg-open (autres OS type unix)");
        openInput.setPreferredSize(new java.awt.Dimension(240, 24));

        gitFolderInput.setText(SavedVariables.getMainGitDir());
        gitFolderInput.setToolTipText("Chemin d'acces (absolu) vers le dossier contenant le repository git de la BPEP.");
        gitFolderInput.setPreferredSize(new java.awt.Dimension(240, 24));

        jLabel4.setText("dossier git");

        jLabel5.setText("dossier modèles");

        javax.swing.GroupLayout jPanel6Layout = new javax.swing.GroupLayout(jPanel6);
        jPanel6.setLayout(jPanel6Layout);
        jPanel6Layout.setHorizontalGroup(
            jPanel6Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
            .addGroup(jPanel6Layout.createSequentialGroup()
                .addGap(0, 0, 0)
                .addGroup(jPanel6Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
                    .addComponent(jLabel8)
                    .addGroup(jPanel6Layout.createSequentialGroup()
                        .addGroup(jPanel6Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.TRAILING)
                            .addComponent(jLabel6)
                            .addGroup(jPanel6Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
                                .addComponent(jLabel5)
                                .addComponent(jLabel4)
                                .addComponent(openEditorLabel)
                                .addComponent(jLabel1)))
                        .addGap(8, 8, 8)
                        .addGroup(jPanel6Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
                            .addComponent(outputDirInput, javax.swing.GroupLayout.PREFERRED_SIZE, 240, javax.swing.GroupLayout.PREFERRED_SIZE)
                            .addComponent(templatesFolderInput, javax.swing.GroupLayout.PREFERRED_SIZE, 240, javax.swing.GroupLayout.PREFERRED_SIZE)
                            .addComponent(openInput, javax.swing.GroupLayout.PREFERRED_SIZE, 240, javax.swing.GroupLayout.PREFERRED_SIZE)
                            .addComponent(gitFolderInput, javax.swing.GroupLayout.PREFERRED_SIZE, 240, javax.swing.GroupLayout.PREFERRED_SIZE)
                            .addComponent(pdflatexInput, javax.swing.GroupLayout.PREFERRED_SIZE, 240, javax.swing.GroupLayout.PREFERRED_SIZE))))
                .addContainerGap())
        );
        jPanel6Layout.setVerticalGroup(
            jPanel6Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
            .addGroup(jPanel6Layout.createSequentialGroup()
                .addContainerGap()
                .addComponent(jLabel8)
                .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED, javax.swing.GroupLayout.DEFAULT_SIZE, Short.MAX_VALUE)
                .addGroup(jPanel6Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.BASELINE)
                    .addComponent(jLabel1)
                    .addComponent(pdflatexInput, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE))
                .addGap(4, 4, 4)
                .addGroup(jPanel6Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.BASELINE)
                    .addComponent(openEditorLabel)
                    .addComponent(openInput, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE))
                .addGap(4, 4, 4)
                .addGroup(jPanel6Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.BASELINE)
                    .addComponent(jLabel4)
                    .addComponent(gitFolderInput, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE))
                .addGap(4, 4, 4)
                .addGroup(jPanel6Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.BASELINE)
                    .addComponent(jLabel5)
                    .addComponent(templatesFolderInput, javax.swing.GroupLayout.PREFERRED_SIZE, 22, javax.swing.GroupLayout.PREFERRED_SIZE))
                .addGap(6, 6, 6)
                .addGroup(jPanel6Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.BASELINE)
                    .addComponent(jLabel6)
                    .addComponent(outputDirInput, javax.swing.GroupLayout.PREFERRED_SIZE, 22, javax.swing.GroupLayout.PREFERRED_SIZE))
                .addGap(12, 12, 12))
        );

        javax.swing.GroupLayout layout = new javax.swing.GroupLayout(this);
        this.setLayout(layout);
        layout.setHorizontalGroup(
            layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
            .addGroup(layout.createSequentialGroup()
                .addGap(4, 4, 4)
                .addGroup(layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
                    .addComponent(jSeparator2)
                    .addGroup(layout.createSequentialGroup()
                        .addGroup(layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
                            .addComponent(jPanel6, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE)
                            .addComponent(jPanel4, javax.swing.GroupLayout.PREFERRED_SIZE, 346, javax.swing.GroupLayout.PREFERRED_SIZE))
                        .addGap(0, 0, Short.MAX_VALUE))))
            .addGroup(layout.createSequentialGroup()
                .addContainerGap()
                .addComponent(jPanel3, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE))
            .addComponent(jPanel2, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE)
            .addComponent(jSeparator3, javax.swing.GroupLayout.Alignment.TRAILING)
            .addComponent(jSeparator4)
        );
        layout.setVerticalGroup(
            layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
            .addGroup(javax.swing.GroupLayout.Alignment.TRAILING, layout.createSequentialGroup()
                .addGap(0, 0, 0)
                .addGroup(layout.createParallelGroup(javax.swing.GroupLayout.Alignment.TRAILING)
                    .addGroup(layout.createSequentialGroup()
                        .addComponent(jPanel3, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE)
                        .addGap(0, 0, 0)
                        .addComponent(jSeparator2, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE)
                        .addGap(180, 180, 180))
                    .addComponent(jPanel6, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE))
                .addGap(0, 0, 0)
                .addComponent(jSeparator4, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE)
                .addGap(4, 4, 4)
                .addComponent(jPanel2, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE)
                .addGap(4, 4, 4)
                .addComponent(jSeparator3, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE)
                .addGap(0, 0, 0)
                .addComponent(jPanel4, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE)
                .addContainerGap(20, Short.MAX_VALUE))
        );
    }// </editor-fold>//GEN-END:initComponents

    private void jCheckBox1ActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_jCheckBox1ActionPerformed
        SavedVariables.setAutoSave(jCheckBox1.isSelected());
    }//GEN-LAST:event_jCheckBox1ActionPerformed

    private void pushButtonActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_pushButtonActionPerformed
        this.setGitOutputText("requête en cours ...");

        SwingUtilities.invokeLater(new Runnable() {
            @Override
            public void run() {
                GitWrapper.push();
                Options.this.setGitOutputText("commit pushed to remote repository");
                String status = GitWrapper.status();
                Options.this.checkStatus(status);
                Options.this.appendGitOutputText("\n - - - - - - -\n" + status);
            }
        });

    }//GEN-LAST:event_pushButtonActionPerformed

    private void commitButtonActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_commitButtonActionPerformed
        this.setGitOutputText("requête en cours ...");

        SwingUtilities.invokeLater(new Runnable() {
            @Override
            public void run() {
                GitWrapper.commit();
                Options.this.setGitOutputText("commit effectué");
                String status = GitWrapper.status();
                Options.this.checkStatus(status);
                Options.this.appendGitOutputText("\n - - - - - - -\n" + status);
            }
        });

    }//GEN-LAST:event_commitButtonActionPerformed

    private void pullButtonActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_pullButtonActionPerformed
        this.setGitOutputText("requête en cours ...");

        SwingUtilities.invokeLater(new Runnable() {
            @Override
            public void run() {
                GitWrapper.pull();
                String out = GitWrapper.pull();
                if (out.contains("CONFLICT")) {
                    Options.this.setGitOutputText("Le même fichier à été modifié à la fois dans le répertoire local et sur le serveur (surement par un autre utlisateur). \n Ce cas n'est pas géré depuis l'interface graphique. \n Effectuez un git pull depuis le terminal, identifiez les conflit à l'aide de git diff, corrigez les, puis effectuez un git commit suivi d'un git push");
                } else {
                    Options.this.setGitOutputText(out);
                }
                String status = GitWrapper.status();
                Options.this.checkStatus(status);
                Options.this.appendGitOutputText("\n - - - - - - -\n" + status);
            }
        });


    }//GEN-LAST:event_pullButtonActionPerformed

    private void checkStatus(String in) {

        this.commitButton.setEnabled(false);
        this.pushButton.setEnabled(false);
        this.pullButton.setEnabled(false);

        if (in.contains("nothing to commit")) {

            if (in.contains("Your branch is behind")) {
                // we can push safely : 
                this.pullButton.setEnabled(true);
            }
            if (in.contains("Your branch is ahead of")) {
                // we can push safely : 
                this.pushButton.setEnabled(true);
            }
            if (in.contains("have diverged,")) {
                this.pullButton.setEnabled(true);
            }

        } else {
            // new changes are not commited, we must commit first
            this.commitButton.setEnabled(true);

        }

    }
    private void statusButtonActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_statusButtonActionPerformed
        this.setGitOutputText("requête en cours ...");
        SwingUtilities.invokeLater(new Runnable() {
            @Override
            public void run() {
                String out = GitWrapper.status();
                Options.this.setGitOutputText(out);

                Options.this.checkStatus(out);
            }
        });

    }//GEN-LAST:event_statusButtonActionPerformed

    private void jCheckBox2ActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_jCheckBox2ActionPerformed
        SavedVariables.setMultiEdit(jCheckBox2.isSelected());
        this.mw.updateGlobalMenuBarStatus();
    }//GEN-LAST:event_jCheckBox2ActionPerformed

    private void autoCompletionCheckBoxActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_autoCompletionCheckBoxActionPerformed
        SavedVariables.setAutoCompletion(autoCompletionCheckBox.isSelected());
    }//GEN-LAST:event_autoCompletionCheckBoxActionPerformed

    private void spellCheckBoxActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_spellCheckBoxActionPerformed
        spellPanel.setVisible(spellCheckBox.isSelected());
        SavedVariables.setSpellCheck(spellCheckBox.isSelected());
    }//GEN-LAST:event_spellCheckBoxActionPerformed

    private void coloringCheckBoxActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_coloringCheckBoxActionPerformed
        coloringPanel.setVisible(coloringCheckBox.isSelected());
        SavedVariables.setColoring(coloringCheckBox.isSelected());
    }//GEN-LAST:event_coloringCheckBoxActionPerformed

    private void nPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_nPerformed
        SavedVariables.setGlobalDict(globalDictTextField.getText());
    }//GEN-LAST:event_nPerformed

    private void titlesCheckBoxActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_titlesCheckBoxActionPerformed
        SavedVariables.setBigTitles(titlesCheckBox.isSelected());
    }//GEN-LAST:event_titlesCheckBoxActionPerformed

    private void colorSetTextFieldActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_colorSetTextFieldActionPerformed


    }//GEN-LAST:event_colorSetTextFieldActionPerformed

    private void tokenComboBoxActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_tokenComboBoxActionPerformed
        tokenComboBoxAction();
    }//GEN-LAST:event_tokenComboBoxActionPerformed

    public void tokenComboBoxAction() {
        int token = LatexTextEditor.getToken((String) tokenComboBox.getSelectedItem());
        Color c = SavedVariables.getColor(token);
        colorSetTextField.setForeground(c);
        colorSetTextField.setText(Utils.getStringFromColor(c));
    }


    // Variables declaration - do not modify//GEN-BEGIN:variables
    private javax.swing.JCheckBox autoCompletionCheckBox;
    private javax.swing.JTextField colorSetTextField;
    private javax.swing.JCheckBox coloringCheckBox;
    private javax.swing.JPanel coloringPanel;
    private javax.swing.JButton commitButton;
    private javax.swing.JTextField customDictTextField;
    private javax.swing.JTextField gitFolderInput;
    private javax.swing.JTextArea gitOutputText;
    private javax.swing.JTextField globalDictTextField;
    private javax.swing.JCheckBox jCheckBox1;
    private javax.swing.JCheckBox jCheckBox2;
    private javax.swing.JLabel jLabel1;
    private javax.swing.JLabel jLabel10;
    private javax.swing.JLabel jLabel11;
    private javax.swing.JLabel jLabel2;
    private javax.swing.JLabel jLabel4;
    private javax.swing.JLabel jLabel5;
    private javax.swing.JLabel jLabel6;
    private javax.swing.JLabel jLabel7;
    private javax.swing.JLabel jLabel8;
    private javax.swing.JLabel jLabel9;
    private javax.swing.JPanel jPanel2;
    private javax.swing.JPanel jPanel3;
    private javax.swing.JPanel jPanel4;
    private javax.swing.JPanel jPanel5;
    private javax.swing.JPanel jPanel6;
    private javax.swing.JSeparator jSeparator2;
    private javax.swing.JSeparator jSeparator3;
    private javax.swing.JSeparator jSeparator4;
    private javax.swing.JLabel openEditorLabel;
    private javax.swing.JTextField openInput;
    private javax.swing.JTextField outputDirInput;
    private javax.swing.JTextField pdflatexInput;
    private javax.swing.JButton pullButton;
    private javax.swing.JButton pushButton;
    private javax.swing.JCheckBox spellCheckBox;
    private javax.swing.JPanel spellPanel;
    private javax.swing.JButton statusButton;
    private javax.swing.JTextField templatesFolderInput;
    private javax.swing.JCheckBox titlesCheckBox;
    private javax.swing.JComboBox<String> tokenComboBox;
    // End of variables declaration//GEN-END:variables
}
